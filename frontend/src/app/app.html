<div class="container">
  <h1>Task Manager</h1>

  @if (error()) {
    <div class="error">
      {{ error() }}
      <button class="btn-close" (click)="error.set(null)">x</button>
    </div>
  }

  <div class="add-task">
    <input
      type="text"
      placeholder="Enter a new task..."
      [ngModel]="newTaskTitle()"
      (ngModelChange)="newTaskTitle.set($event)"
      (keyup.enter)="addTask()"
    />
    <button class="btn-primary" (click)="addTask()">Add Task</button>
  </div>

  @if (loading()) {
    <div class="loading">Loading tasks...</div>
  } @else {
    @if (tasks().length === 0) {
      <div class="empty">No tasks yet. Add one above!</div>
    } @else {
      <ul class="task-list">
        @for (task of tasks(); track task.id) {
          <li class="task-item" [class.completed]="task.isCompleted">
            @if (editingTask()?.id === task.id) {
              <div class="edit-form">
                <input
                  type="text"
                  [ngModel]="editTitle()"
                  (ngModelChange)="editTitle.set($event)"
                  (keyup.enter)="saveEdit()"
                  (keyup.escape)="cancelEdit()"
                />
                <button class="btn-save" (click)="saveEdit()">Save</button>
                <button class="btn-cancel" (click)="cancelEdit()">Cancel</button>
              </div>
            } @else {
              <div class="task-content">
                <input
                  type="checkbox"
                  [checked]="task.isCompleted"
                  (change)="toggleComplete(task)"
                />
                <span class="task-title">{{ task.title }}</span>
              </div>
              <div class="task-actions">
                <button class="btn-edit" (click)="startEdit(task)">Edit</button>
                <button class="btn-delete" (click)="deleteTask(task.id)">Delete</button>
              </div>
            }
          </li>
        }
      </ul>
    }
  }

  <div class="stats">
    Total: {{ tasks().length }} |
    Completed: {{ completedCount() }} |
    Pending: {{ pendingCount() }}
  </div>
</div>
